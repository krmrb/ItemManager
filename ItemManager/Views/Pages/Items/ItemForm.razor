@using ItemManagerClient.Models
@using ItemManagerClient.Enums

<div style="max-width: 600px; margin: 0 auto;">
    
    <!-- Section Informations de base -->
    <div style="margin-bottom: 20px;">
        <h3>Informations de base</h3>
        
        <!-- Titre -->
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Tâche</label>
            <input type="text" @bind="NewItem.Title" placeholder="Titre de la tâche" 
                   style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;" />
        </div>

        <!-- Description -->
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Description</label>
            <textarea @bind="NewItem.Description" placeholder="Décrivez les objectifs, participants, ressources nécessaires..."
                      rows="4" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;"></textarea>
        </div>

        <!-- Date -->
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Date</label>
            <input type="date" @bind="NewItem.Date" 
                   style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;" />
        </div>
    </div>

    <!-- Section Heure -->
    <div style="margin-bottom: 20px;">
        <h3>Heure de la tâche</h3>
        
        <!-- Toute la journée -->
        <div style="margin-bottom: 15px;">
            <label>
                <input type="checkbox" @bind="NewItem.IsAllDay" />
                Toute la journée
            </label>
        </div>

        @if (!NewItem.IsAllDay)
        {
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label style="display: block; font-weight: bold; margin-bottom: 5px;">De</label>
                    <input type="time" @bind="StartTimeString" 
                           style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;" />
                </div>
                <div style="flex: 1;">
                    <label style="display: block; font-weight: bold; margin-bottom: 5px;">À</label>
                    <input type="time" @bind="EndTimeString" 
                           style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;" />
                </div>
            </div>
        }
    </div>

    <!-- Section Statut et Catégorie -->
    <div style="margin-bottom: 20px;">
        <h3>Classification</h3>
        
        <div style="display: flex; gap: 15px;">
            <!-- Statut -->
            <div style="flex: 1;">
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Statut</label>
                <select @bind="NewItem.Status" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
                    <option value="@ItemStatus.Draft">📝 Brouillon</option>
                    <option value="@ItemStatus.Open">🔓 Ouvert</option>
                    <option value="@ItemStatus.Pending">⏳ En attente</option>
                    <option value="@ItemStatus.Canceled">❌ Annulé</option>
                    <option value="@ItemStatus.Closed">✅ Fermé</option>
                </select>
            </div>

            <!-- Catégorie -->
            <div style="flex: 1;">
                <label style="display: block; font-weight: bold; margin-bottom: 5px;">Catégorie</label>
                <select @bind="NewItem.CategoryId" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
                    <option value="1">📅 Réunion</option>
                    <option value="2">📊 Projet</option>
                    <option value="3">🔧 Maintenance</option>
                    <option value="4">🎓 Formation</option>
                    <option value="5">📋 Reporting</option>
                    <option value="6">❓ Autre</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Boutons d'action -->
    <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button @onclick="Cancel" style="padding: 10px 20px; border: 1px solid #ccc; background: white; border-radius: 5px;">
            Annuler
        </button>
        <button @onclick="SaveItem" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;">
            Enregistrer
        </button>
    </div>

</div>

@code {
    private Item NewItem { get; set; } = new Item();
    private string StartTimeString { get; set; } = "09:00";
    private string EndTimeString { get; set; } = "17:00";

    protected override void OnInitialized()
    {
        // Initialiser avec des valeurs par défaut
        NewItem.Date = DateTime.Today;
        NewItem.Status = ItemStatus.Draft;
        NewItem.CategoryId = 1;
    }

    private void SaveItem()
    {
        // Convertir les heures strings en TimeSpan
        if (!NewItem.IsAllDay)
        {
            if (TimeSpan.TryParse(StartTimeString, out var startTime))
                NewItem.StartTime = startTime;
            
            if (TimeSpan.TryParse(EndTimeString, out var endTime))
                NewItem.EndTime = endTime;
        }

        // Ici, normalement vous appelleriez le service pour sauvegarder
        Console.WriteLine($"Item sauvegardé: {NewItem.Title}");
        
        // Réinitialiser le formulaire
        NewItem = new Item { 
            Date = DateTime.Today, 
            Status = ItemStatus.Draft, 
            CategoryId = 1 
        };
        StartTimeString = "09:00";
        EndTimeString = "17:00";
    }

    private void Cancel()
    {
        // Retour à la liste
        NewItem = new Item { 
            Date = DateTime.Today, 
            Status = ItemStatus.Draft, 
            CategoryId = 1 
        };
    }
}