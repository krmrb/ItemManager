@using Microsoft.AspNetCore.Components.Web
@using ItemManagerClient.Services
@inject IItemService ItemService
@inject ICategoryService CategoryService

<PageTitle>ItemManager</PageTitle>

<div style="padding: 20px;">
    <!-- En-tête -->
    <div style="background: #2c3e50; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
        <h1 style="margin: 0;">📋 ItemManager</h1>
        <p style="margin: 5px 0 0 0; opacity: 0.8;">Gestionnaire d'items</p>
    </div>

    <!-- Navigation -->
    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <button class="btn @GetButtonClass("")" @onclick="() => NavigateTo("")">
            🏠 Accueil
        </button>
        <button class="btn @GetButtonClass("items")" @onclick="() => NavigateTo("items")">
            📋 Items
        </button>
        <button class="btn @GetButtonClass("create")" @onclick="NavigateToCreate">
            ➕ Nouvel Item
        </button>
    </div>

    <!-- Contenu -->
    <div style="min-height: 400px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        @if (CurrentPage == "items" && IsCreating)
        {
            <h2>📝 Formulaire Item</h2>
            <p>Le formulaire apparaîtra ici...</p>
            <button @onclick="() => NavigateTo("items")" style="background: #6c757d; color: white; padding: 10px; border: none; border-radius: 5px;">
                ← Retour à la liste
            </button>
        }
        else if (CurrentPage == "items")
        {
            <h2>📋 Liste des Items</h2>
            <ItemList />
        }
        else
        {
            <h2>🏠 Page d'Accueil</h2>
            <HomePage />
        }
    </div>

    <!-- Debug -->
    <div style="margin-top: 20px; padding: 10px; background: #e9ecef; border-radius: 5px; font-size: 12px;">
        <strong>Debug:</strong> Page: @CurrentPage, Creation: @IsCreating
    </div>
</div>

@code {
    private string CurrentPage = "";
    private bool IsCreating = false;

    protected override void OnInitialized()
    {
        // Charger les données au démarrage
        Console.WriteLine("Main.razor initialisé");
    }

    private void NavigateTo(string page)
    {
        Console.WriteLine($"Navigation vers: {page}");
        CurrentPage = page;
        IsCreating = false;
        StateHasChanged(); // Force le re-rendu
    }

    private void NavigateToCreate()
    {
        Console.WriteLine("Navigation vers création");
        CurrentPage = "items";
        IsCreating = true;
        StateHasChanged(); // Force le re-rendu
    }

    private string GetButtonClass(string page)
    {
        if (page == "create" && IsCreating) return "btn-primary";
        if (page == CurrentPage && !IsCreating) return "btn-primary";
        return "btn-outline-primary";
    }
}